---
layout: post
title: 为什么要开发 flying
description: Mybatis 是一个简约而强大的orm解决方案，而 flying 是它的扩展插件。
category: blog
---
## mybatis.flying是什么
众所周知，Mybatis 在设计之初是作为一个工作于单线程之下的中间件而存在，虽然它易于上手，但放到互联网环境下使用时，初学者不可避免的要面对诸如“一级缓存存在脏数据”、“需要写大量明文 SQL 语句”等问题。这些是用户最关心的“是否可用”级别问题，也是 Mybatis-3 系列版本中开发团队并没有完全解决的问题，或者说，相对于另一个竞争产品 Hibernate，Mybatis 的开发团队选择了一种更谦逊的方式，他们开放 Mybatis 接口，允许用户开发插件，按自己的方式来解决这些问题。于是，一切 ORM 领域相关的问题在 Mybatis 上通过插件都有了解决方案。而本文所要介绍的 flying，则是集成了用户最需要的几个功能的插件组。与此同时 flying 提出了一种新的调用数据的方式，希望能对您起到抛砖引玉的作用。

## 如何获取 flying

目前 flying 还不在 maven 中心库内（尚在 apache 上申请中），所以若要使用需要先在 maven 全局配置文件或POM文件中加入以下仓库： 
```
<repository>
    <id>dpm-Release</id>
    <url>http://vpn.dpm.im:8081/nexus/content/repositories/releases/</url>
</repository>
```    
之后在POM文件中加入依赖：
```
<groupId>indi.mybatis</groupId>
<artifactId>mybatis.flying</artifactId>
<version>0.7.0</version>
```    
即可以使用。当前最新版本为 0.7.0。flying 默认依赖 Mybatis-3.2.5 版本，如果您对实际项目中的 Mybatis 版本有特别需求（但建议使用 Mybatis-3 系列内的版本）或您使用的是个人定制版的Mybatis，您可以在依赖配置中加入 `exclusions`，就像下面这样：
```
<dependency>
    <groupId>indi.mybatis</groupId>
    <artifactId>mybatis.flying</artifactId>
    <version>0.7.0</version>
    <exclusions>
        <exclusion>
            <groupId>org.mybatis</groupId>
            <artifactId>mybatis</artifactId>
        </exclusion>
    </exclusions>
</dependency>
```
在您做好以上配置之后，flying 会自动下载到您的电脑本地。

## 如何使用mybatis.flying

使用本插件前您需要具备Java开发数据库应用的知识，和使用Mybatis基本功能的经验。
在Mybatis中，有一个核心的配置文件，称做Configuration.xml，我们的插件需要先在这里配置，才能在运行期被识别出来。

在Configuration.xml中，首先为了让Mybatis在多线程环境下工作的更好，需要在`settings`中进行以下设置：

    <settings>
        <setting name="lazyLoadingEnabled" value="false" />
        <setting name="aggressiveLazyLoading" value="false" />
        <setting name="localCacheScope" value="SESSION" />
        <setting name="autoMappingBehavior" value="PARTIAL" />
        <setting name="lazyLoadTriggerMethods" value="" />
    </settings>
 
 （以上配置中没有提到的内容用户可按照自己的实际情况进行配置）
 
 然后，在Configuration.xml的底部，我们加入`plugins`元素，将flying中的Interceptor（拦截器）配置成`plugin`，然后放到`plugins`中。例如目前flying有两个主要拦截器（负责处理pojo自动注射的`AutoMapperInterceptor`和负责完善二级缓存的`EnhancedCachingInterceptor`），配置它们的方式如下：
 
    <plugins>
        <plugin interceptor="indi.mybatis.flying.interceptors.AutoMapperInterceptor">
            <property name="dialect" value="mysql" />
        </plugin>
        <plugin interceptor="indi.mybatis.flying.interceptors.EnhancedCachingInterceptor">
            <property name="cacheEnabled" value="true" />
        </plugin>
    </plugins>
 
 （以上配置中`dialect`标识了目标数据库为mysql，`cacheEnabled`标识了二级缓存为打开状态，更多的属性请参见讲解该插件的章节。）
 
 配置好以上内容之后，保存Configuration.xml文件，按正常方式启动Mybatis，flying即可生效。
 
## 如何查看flying的源代码
 
 flying的代码在github上进行开源，访问地址为[https://github.com/limeng32/mybatis.flying](https://github.com/limeng32/mybatis.flying) ，您可以在github上通过Issues与我们联系，提出您的需要，或是加入我们成为贡献者，提交您的代码，我们非常欢迎您这样做。
 
 目前我们的路线图是：解决flying在跨库运行中的问题、在跨库事务中的问题、和其它缓存中间件的无缝集成问题等等。
